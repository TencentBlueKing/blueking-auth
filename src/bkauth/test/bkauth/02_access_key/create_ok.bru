meta {
  name: create_ok
  type: http
  seq: 17
}

post {
  url: http://{{host}}:{{port}}/api/v1/apps/demo/access-keys
  body: json
  auth: none
}

headers {
  X-Bk-App-Code: {{x_bk_app_code}}
  X-Bk-App-Secret: {{x_bk_app_secret}}
}

body:json {
  {}
}

assert {
  res.status: eq 200
  res.body.code: eq 0
  res.body.message: eq ok
  res.body.data.bk_app_code: eq demo
  res.body.data.bk_app_secret: isString
  res.body.data.enabled: eq true
}

script:post-response {
  // 保存创建的 access_key_id 和 app_secret 到环境变量
  if (res.body.code === 0) {
    bru.setEnvVar("access_key_id", res.body.data.id);
    bru.setEnvVar("app_secret", res.body.data.bk_app_secret);
  }
}